<!DOCTYPE html>
<html>
<head>
    <title>MH Wilds Total Damage Calculator (Detailed)</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <style>
        body { font-family: sans-serif; margin: 0; padding: 20px; line-height: 1.5; background-color: #f4f4f4;}
        .container { max-width: 960px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);} /* コンテンツを中央寄せ */
        label { display: inline-block; width: 280px; margin-bottom: 5px; font-weight: bold; }
        input[type="number"], input[type="text"], select {
             width: 150px; /* デフォルト幅を調整 */
             padding: 8px;
             border: 1px solid #ccc;
             border-radius: 4px;
             margin-bottom: 10px;
             box-sizing: border-box; /* paddingとborderを幅に含める */
        }
         input[type="number"] { width: 80px; margin-right: 10px; } /* 数値入力の幅を調整 */

        input[type="checkbox"] { margin-bottom: 5px; transform: scale(1.2); margin-right: 5px; vertical-align: middle; }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            margin-right: 10px;
            transition: background-color 0.3s ease;
        }
        button:hover { background-color: #45a049; }
        button.save-button { background-color: #007bff; }
        button.save-button:hover { background-color: #0056b3; }
         button.load-button { background-color: #ffc107; color: #212529;}
         button.load-button:hover { background-color: #e0a800; }
         button.delete-button { background-color: #dc3545; }
         button.delete-button:hover { background-color: #c82333; }
         button.secondary-button { background-color: #6c757d; margin-top: 0; } /* モーダル内のボタン用 */
         button.secondary-button:hover { background-color: #5a6268; }


        .section-title { margin-top: 20px; margin-bottom: 10px; font-weight: bold; border-bottom: 2px solid #eee; padding-bottom: 5px; font-size: 1.2em;}
        #results { margin-top: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; }
        #results h3 { margin-top: 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        #results p { margin-bottom: 5px; }

        .attack-list { margin-bottom: 15px; }
        .attack-list label { width: auto; margin-right: 15px; margin-bottom: 8px; font-weight: normal; } /* モーション名のラベル幅を自動に */
        .attack-group-title { font-weight: bold; margin-top: 10px; margin-bottom: 5px; border-bottom: 1px dotted #ccc; padding-bottom: 2px;}

         .skill-category-title { font-weight: bold; margin-top: 15px; margin-bottom: 8px; border-bottom: 1px solid #ddd; padding-bottom: 3px; }
        .skill-item { margin-bottom: 8px; display: flex; align-items: center;} /* 各スキル項目をflexboxで横並びに */
        .skill-item label { width: 180px; font-weight: normal; margin-bottom: 0; } /* スキル名ラベルの幅固定 */
         .skill-item select { margin-left: auto; flex-shrink: 0; } /* レベル選択ドロップダウン */
         .skill-item input[type="checkbox"] { flex-shrink: 0; }

        /* --- Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-dialog {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            width: 90%; /* スマホ考慮して幅を%に */
            max-width: 500px; /* PCでの最大幅 */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .modal-dialog h3 {
             margin-top: 0;
             margin-bottom: 15px;
             border-bottom: 1px solid #eee;
             padding-bottom: 8px;
        }

         .modal-dialog .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            border: none;
            background: none;
            cursor: pointer;
            padding: 5px;
            margin: 0;
         }
         .modal-dialog .close-button:hover {
            color: #dc3545;
         }

        .modal-dialog .control-group {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dotted #ccc;
        }
         .modal-dialog .control-group:last-child {
             border-bottom: none;
             padding-bottom: 0;
         }

        .modal-dialog .control-group label {
            width: auto; /* モーダル内のラベル幅自動 */
            margin-right: 10px;
            font-weight: normal;
        }
         .modal-dialog .control-group input[type="text"],
         .modal-dialog .control-group select {
             width: auto; /* モーダル内の入力/選択幅自動 */
             flex-grow: 1; /* 必要に応じて幅を広げる */
         }
         .modal-dialog .control-group div {
             display: flex;
             align-items: center;
             margin-bottom: 8px;
         }
         .modal-dialog .control-group div:last-child {
             margin-bottom: 0;
         }


        /* --- Responsive Styles --- */
        @media (max-width: 768px) {
            body { padding: 10px; }
             .container { padding: 15px; }

            label {
                width: 100%; /* 狭い画面ではラベルを100%幅に */
                margin-bottom: 5px;
            }
            input[type="number"], input[type="text"], select {
                 width: 100%; /* 入力フィールドも100%幅に */
                 margin-right: 0;
                 margin-bottom: 10px;
            }
             input[type="number"] { width: 100%; } /* 個別指定も100%に */

            button {
                 width: 100%; /* ボタンも100%幅に */
                 margin-right: 0;
                 margin-bottom: 10px;
            }
             button:last-child { margin-bottom: 0; } /* 最後のボタンの下余白調整 */
             button.secondary-button { margin-bottom: 10px; }

            .skill-item {
                flex-direction: column; /* スキル項目を縦並びに */
                align-items: flex-start; /* 左寄せ */
            }
             .skill-item label { width: 100%; margin-bottom: 5px; } /* ラベルも100%幅 */
             .skill-item select { margin-left: 0; width: 100%; } /* ドロップダウンも100%幅 */
             .skill-item input[type="checkbox"] { margin-bottom: 5px; }


             .modal-dialog {
                width: 95%; /* さらに狭く */
                padding: 15px;
             }
             .modal-dialog .control-group div {
                 flex-direction: column; /* モーダル内の要素も縦積みに */
                 align-items: flex-start;
             }
              .modal-dialog .control-group label { width: 100%; margin-bottom: 5px;}
              .modal-dialog .control-group input[type="text"],
              .modal-dialog .control-group select { width: 100%; margin-right: 0; margin-bottom: 8px;}
         }


    </style>
</head>
<body>
    <div class="container">

        <h2>MH Wilds 太刀 合計ダメージ計算ツール (詳細版)</h2>
        <p>選択した攻撃モーションの連携による合計ダメージを計算します。</p>
        <p>入力項目とスキルレベルを調整し、連携に含めたい攻撃にチェックを入れて「合計ダメージを計算」ボタンを押してください。</p>
        <p>※モーション値・スキル効果はコミュニティの検証情報に基づき、製品版と異なる場合があります。</p>

        <div class="section-title">武器基本性能</div> <div><label for="baseRaw">武器基礎攻撃力:</label><input type="number" id="baseRaw" value="220"></div>
        <div><label for="baseAffinity">武器基礎会心率 (%):</label><input type="number" id="baseAffinity" value="5"></div>
        <div><label for="baseDisplayElem">武器表示属性値:</label><input type="number" id="baseDisplayElem" value="350"></div> <div><label for="sharpnessPhys">斬れ味物理補正 (白):</label><input type="number" id="sharpnessPhys" value="1.32" step="0.01"></div>
        <div><label for="sharpnessElem">斬れ味属性補正 (白):</label><input type="number" id="sharpnessElem" value="1.15" step="0.01"></div>
        <div class="section-title">モンスター肉質 (歴戦王レダウ 想定)</div>
        <div><label for="hitzoneRawHead">頭部 物理肉質:</label><input type="number" id="hitzoneRawHead" value="60"></div>
        <div><label for="hitzoneElemHead">頭部 属性肉質:</label><input type="number" id="hitzoneElemHead" value="20"></div>
        <div><label for="hitzoneRawLeg">足部 物理肉質:</label><input type="number" id="hitzoneRawLeg" value="37"></div>
        <div><label for="hitzoneElemLeg">足部 属性肉質:</label><input type="number" id="hitzoneElemLeg" value="10"></div>
        <div><label for="isLegHardTarget">足部を硬い部位として扱う (心眼適用判定):</label><input type="checkbox" id="isLegHardTarget" checked></div>

        <div class="section-title">スキル設定</div>
        <p>※チェックで有効/無効を切り替え、ドロップダウンでレベルを選択してください。</p>

        <div class="skill-category-title">武器スキル</div>
        <div class="skill-item">
            <input type="checkbox" id="skillAttackToggle" data-skill-id="attack">
            <label for="skillAttackToggle">攻撃</label>
             <select id="skillAttackLevelSelect" data-skill-id="attack" disabled>
                 <option value="0">Lv0</option><option value="1">Lv1</option><option value="2">Lv2</option><option value="3">Lv3</option><option value="4">Lv4</option><option value="5">Lv5</option><option value="6">Lv6</option><option value="7" selected>Lv7</option>
             </select>
        </div>
        <div class="skill-item">
            <input type="checkbox" id="skillCriticalEyeToggle" data-skill-id="criticalEye">
            <label for="skillCriticalEyeToggle">見切り</label>
             <select id="skillCriticalEyeLevelSelect" data-skill-id="criticalEye" disabled>
                 <option value="0">Lv0</option><option value="1">Lv1</option><option value="2">Lv2</option><option value="3">Lv3</option><option value="4">Lv4</option><option value="5">Lv5</option><option value="6">Lv6</option><option value="7" selected>Lv7</option>
             </select>
        </div>
        <div class="skill-item">
            <input type="checkbox" id="skillCritBoostToggle" data-skill-id="critBoost">
            <label for="skillCritBoostToggle">超会心</label>
             <select id="skillCritBoostLevelSelect" data-skill-id="critBoost" disabled>
                 <option value="0">Lv0</option><option value="1">Lv1</option><option value="2">Lv2</option><option value="3">Lv3</option><option value="4">Lv4</option><option value="5" selected>Lv5</option>
             </select>
        </div>
        <div class="skill-item">
            <input